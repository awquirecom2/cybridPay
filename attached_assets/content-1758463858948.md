# Recipes

**Creating a Verified Individual Customer**

Begin by adding a customer and verifying their identity

IN THIS RECIPE

1. Create a customer
2. Wait for the customer to be unverified
3. Create a KYC identity verification

•••

1. Wait for the Persona inquiry ID to be generated
2. Launch the Persona SDK
3. Wait for the identity verification to complete
4. Check the outcome of the verification
5. Retrieve the customer

Open Recipe

Python

```
xxxxxxxxxx
```

1

```
#
```

2

```
# Constants
```

3

```
#
```

4

```
​
```

5

```
CUSTOMER_TYPE_INDIVIDUAL = "individual"
```

6

```
CUSTOMER_TYPE_BUSINESS = "business"
```

7

```
​
```

8

```
IDENTITY_VERIFICATION_TYPE_KYC = "kyc"
```

9

```
IDENTITY_VERIFICATION_TYPE_BANK_ACCOUNT = "bank_account"
```

10

```
​
```

11

```
IDENTITY_VERIFICATION_METHOD_ID_AND_SELFIE = "id_and_selfie"
```

12

```
IDENTITY_VERIFICATION_METHOD_ACCOUNT_OWNERSHIP = "account_ownership"
```

13

```
​
```

14

```
IDENTITY_VERIFICATION_EXPECTED_BEHAVIOUR_PASSED_IMMEDIATELY = "passed_immediately"
```

15

```
​
```

16

```
STATE_CREATED = "created"
```

17

```
STATE_PENDING = "pending"
```

18

```
STATE_COMPLETED = "completed"
```

19

```
STATE_SETTLING = "settling"
```

20

```
STATE_WAITING = "waiting"
```

21

```
STATE_UNVERIFIED = "unverified"
```

22

```
STATE_VERIFIED = "verified"
```

23

```
​
```

24

```
OUTCOME_PASSED = "passed"
```

25

```
OUTCOME_FAILED = "failed"
```

26

```
​
```

27

```
ASSET_CODE_USD = "USD"
```

28

```
ASSET_CODE_USDC = "USDC"
```

29

```
​
```

30

```
ACCOUNT_TYPE_FIAT = "fiat"
```

31

```
ACCOUNT_TYPE_TRADING = "trading"
```

32

```
​
```

33

```
DEPOSIT_BANK_ACCOUNT_TYPE_MAIN = "main"
```

34

```
​
```

35

```
#
```

36

```
# Helpers
```

37

```
#
```

38

```
​
```

39

```
logger = logging.getLogger()
```

40

```
​
```

41

```
def create_customer(
```

42

```
    api_client: cybrid_api_bank.ApiClient, customer_type: str
```

43

```
) -> Customer:
```

44

```
    logger.info("Creating customer...")
```

45

```
​
```

46

```
    api_instance = CustomersBankApi(api_client)
```

47

```
    post_customer = PostCustomer(type=customer_type)
```

48

```
​
```

49

```
    try:
```

50

```
        # https://docs.cybrid.xyz/reference/createcustomer
```

51

```
        customer = api_instance.create_customer(post_customer)
```

52

```
        logger.info("Created customer: %s", customer.guid)
```

53

```
        return customer
```

54

```
    except cybrid_api_bank.OpenApiException as e:
```

55

```
        logger.error(f"An API error occurred when creating customer: {e}")
```

56

```
        raise e
```

57

```
​
```

58

```
​
```

59

```
def get_customer(api_client: cybrid_api_bank.ApiClient, guid: str) -> Customer:
```

60

```
    logger.info("Getting customer: %s", guid)
```

61

```
​
```

62

```
    api_instance = CustomersBankApi(api_client)
```

63

```
​
```

64

```
    try:
```

65

```
        # https://docs.cybrid.xyz/reference/getcustomer
```

66

```
        customer = api_instance.get_customer(guid)
```

67

```
        logger.info("Got customer: %s", customer.guid)
```

68

```
        return customer
```

69

```
    except cybrid_api_bank.OpenApiException as e:
```

70

```
        logger.error(f"An API error occurred when getting customer: {e}")
```

71

```
        raise e
```

72

```
​
```

73

```
​
```

74

```
def wait_for_customer(
```

75

```
    api_client: cybrid_api_bank.ApiClient,
```

76

```
    customer: Customer,
```

77

```
    expected_states: list[str],
```

78

```
) -> None:
```

79

```
    sleep_count = 0
```

80

```
    customer_state = customer.state
```

81

```
    final_states = expected_states
```

82

```
    while customer_state not in final_states and sleep_count < Config.TIMEOUT:
```

83

```
        time.sleep(1)
```

84

```
        sleep_count += 1
```

85

```
        customer = get_customer(api_client, customer.guid)
```

86

```
        customer_state = customer.state
```

87

```
    if customer_state not in final_states:
```

88

```
        raise BadResultError(f"Customer has invalid state: {customer_state}")
```

89

```
​
```

90

```
    logger.info(f"Customer successfully created with state {customer_state}")
```

91

```

```

92

```
def create_identity_verification(
```

93

```
    api_client: cybrid_api_bank.ApiClient,
```

94

```
    customer: Customer,
```

95

```
    verification_type: str,
```

96

```
    verification_method: str,
```

97

```
    expected_behaviours: list[str] | None = None,
```

98

```
) -> IdentityVerification:
```

99

```
    logger.info("Creating identity verification...")
```

100

```
​
```

101

```
    api_instance = IdentityVerificationsBankApi(api_client)
```

102

```
    post_identity_verification = PostIdentityVerification(
```

103

```
        type=verification_type,
```

104

```
        method=verification_method,
```

105

```
        customer_guid=customer.guid,
```

106

```
        expected_behaviours=expected_behaviours,
```

107

```
    )
```

108

```
​
```

109

```
    try:
```

110

```
        # https://docs.cybrid.xyz/reference/createidentityverification
```

111

```
        api_response = api_instance.create_identity_verification(
```

112

```
            post_identity_verification
```

113

```
        )
```

114

```
        logger.info("Created identity verification.")
```

115

```
        return api_response
```

116

```
    except cybrid_api_bank.OpenApiException as e:
```

117

```
        logger.error(f"An API error occurred when creating identity verification: {e}")
```

118

```
        raise e
```

119

```
​
```

120

```
​
```

121

```
def get_identity_verification(
```

122

```
    api_client: cybrid_api_bank.ApiClient, guid: str
```

123

```
) -> IdentityVerification:
```

124

```
    logger.info("Getting identity verification...")
```

125

```
​
```

126

```
    api_instance = IdentityVerificationsBankApi(api_client)
```

127

```
​
```

128

```
    try:
```

129

```
        # https://docs.cybrid.xyz/reference/getidentityverification
```

130

```
        identity_verification = api_instance.get_identity_verification(guid)
```

131

```
        logger.info("Got identity verification: %s", identity_verification.guid)
```

132

```
        return identity_verification
```

133

```
    except cybrid_api_bank.OpenApiException as e:
```

134

```
        logger.error(f"An API error occurred when getting identity verification: {e}")
```

135

```
        raise e
```

136

```
​
```

137

```
​
```

138

```
def wait_for_identity_verification(
```

139

```
    api_client: cybrid_api_bank.ApiClient,
```

140

```
    identity_verification: IdentityVerification,
```

141

```
    expected_states: list[str],
```

142

```
) -> None:
```

143

```
    sleep_count = 0
```

144

```
    identity_verification_state = identity_verification.state
```

145

```
    final_states = expected_states
```

146

```
    while (
```

147

```
        identity_verification_state not in final_states and sleep_count < Config.TIMEOUT
```

148

```
    ):
```

149

```
        time.sleep(1)
```

150

```
        sleep_count += 1
```

151

```
        identity_verification = get_identity_verification(
```

152

```
            api_client, identity_verification.guid
```

153

```
        )
```

154

```
        identity_verification_state = identity_verification.state
```

155

```
    if identity_verification_state not in final_states:
```

156

```
        raise BadResultError(
```

157

```
            f"Identity verification has invalid state: {identity_verification_state}"
```

158

```
        )
```

159

```
​
```

160

```
    logger.info(
```

161

```
        f"Identity verification successfully completed with state {identity_verification_state}"
```

162

```
    )
```

163

```
​
```

164

```
#
```

165

```
# Create customer
```

166

```
#
```

167

```
# This will create a customer of type "individual." To create a business
```

168

```
# customer, set `customer_type=CUSTOMER_TYPE_BUSINESS`.
```

169

```
#
```

170

```
# The customer will initially be in the `storing` state. Before proceeding,
```

171

```
# wait for the customer to be in the `unverified` state.
```

172

```
#
```

173

```
​
```

174

```
# Step 1: Create the customer
```

175

```
customer = create_customer(api_client, customer_type=CUSTOMER_TYPE_INDIVIDUAL)
```

176

```
​
```

177

```
# Step 2: Wait for the customer to settle in the `unverified` state.
```

178

```
wait_for_customer(api_client, customer, expected_states=[STATE_UNVERIFIED])
```

179

```
​
```

180

```
#
```

181

```
# Create identity verification
```

182

```
#
```

183

```
# This will initiate an identity verification that must be continued in an interactive fashion by
```

184

```
# the customer through Persona. This applies both for individuals and businesses.
```

185

```
#
```

186

```
# In order to verify a customer set the `type` to `kyc` and the `method` to either `id_and_selfie`
```

187

```
# for individuals (i.e., KYC) or `business_registration` for businesses (i.e., KYB).
```

188

```
#
```

189

```
# Identity verification is a four step process:
```

190

```
# 1. Create the identity verification (https://docs.cybrid.xyz/reference/createidentityverification).
```

191

```
#    This will immediately create an identity verification in the `storing` state.
```

192

```
# 2. Poll on the identity verification until it is in the `waiting` state. When in the `waiting` state
```

193

```
#    read the `persona_inquiry_id` value (https://docs.cybrid.xyz/reference/getidentityverification).
```

194

```
# 3. Launch the Persona SDK and pass it the `persona_inquiry_id` obtained in the previous step. For a
```

195

```
#    sample HTML application that launches the Persona SK see here:
```

196

```
#    https://docs.cybrid.xyz/docs/how-do-i-drive-kyc-manually.
```

197

```
# 4. Poll on the identity verification until it is in the `completed`. Check the `outcome` of the
```

198

```
#    identity verification, it will be either `passed` or `failed. If `failed`, the customer cannot
```

199

```
#    interact with the platform.
```

200

```
#
```

201

```
# Once these steps are completed and `state=completed` and `outcome=passed`, the customer state
```

202

```
# will be `verified`. You can get the state of the customer by retrieving the customer resource
```

203

```
# (https://docs.cybrid.xyz/reference/getcustomer).
```

204

```
#
```

205

```
# If the identity verification goes into the state `expired` then you can create a new identity
```

206

```
# verification and use the newly created `persona_inquiry_id` to verify the customer. If the
```

207

```
# identity verification is in the `waiting` state and the customer wants to resume their session,
```

208

```
# then you can re-use the `persona_inquiry_id` to verify the customer.
```

209

```
#
```

210

```
# If the identity verification goes into the state `pending` then it indicates the UBOs associated
```

211

```
# with the business must complete their KYC before the verification can proceed.
```

212

```
#
```

213

```
# To enhance the responsiveness of your application to state changes, you can also register for
```

214

```
# and receive webhooks for identity verification state changes See the article here:
```

215

```
# https://docs.cybrid.xyz/docs/webhooks.
```

216

```
#
```

217

```
​
```

218

```
# Step 1: Create the identity verification
```

219

```
identity_verification = create_identity_verification(
```

220

```
  api_client,
```

221

```
  customer,
```

222

```
  verification_type=IDENTITY_VERIFICATION_TYPE_KYC,
```

223

```
  verification_method=IDENTITY_VERIFICATION_METHOD_ID_AND_SELFIE,
```

224

```
)
```

225

```
​
```

226

```
# Step 2: Wait for the identity verification to go into the `waiting` state
```

227

```
wait_for_identity_verification(
```

228

```
    api_client, identity_verification, expected_states=[STATE_WAITING]
```

229

```
)
```

230

```
​
```

231

```
# Step 3: Retrieve the `persona_inquiry_id` and send the customer through the Persona flow
```

232

```
identity_verification = get_identity_verification(
```

233

```
  api_client, identity_verification.guid
```

234

```
)
```

235

```
logger.info(f"Persona inquiry id: {identity_verification.persona_inquiry_id}")
```

236

```
​
```

237

```
# Step 4: Wait for the identity verification to go into the `completed` state and chck
```

238

```
#         the outcome.
```

239

```
wait_for_identity_verification(
```

240

```
  api_client, identity_verification, expected_states=[STATE_COMPLETED]
```

241

```
)
```

242

```
​
```

243

```
identity_verification = get_identity_verification(
```

244

```
  api_client, identity_verification.guid
```

245

```
)
```

246

```
if identity_verification.outcome == OUTCOME_FAILED:
```

247

```
  raise BadResultError(
```

248

```
    f"Identity verification has an unexpected outcome: {identity_verification}."
```

249

```
  )
```

250

```
​
```

251

```
#
```

252

```
# Check the state of the customer
```

253

```
#
```

254

```
wait_for_customer(api_client, customer, expected_states=[STATE_VERIFIED])
```

- ## Creating a Verified Individual Customer







Begin by adding a customer and verifying their identity







8 Steps

Open Recipe

- ## Creating a Verified Business Counterparty







This recipe assumes you've already created a verified customer







6 Steps

Open Recipe

- ## Creating Customer Accounts on the Platform







This recipe assumes you've already created a verified customer







6 Steps

Open Recipe

- ## Adding Counterparty Accounts to the Platform







This recipe assumes you've already created a verified counterparty







4 Steps

Open Recipe

- ## Adding a Customer's Verified External Bank Account







This recipe assumes you've already created a verified customer







9 Steps

Open Recipe

- ## Adding a Customer's External Wallet







This recipe assumes you've already created a verified customer







2 Steps

Open Recipe

- ## Funding a Customer's Fiat Account







This recipe assumes you've already created a verified customer, created accounts for the customer and connected a verified external bank account.







4 Steps

Open Recipe

- ## On-Ramping to USDC







This recipe assumes you've funded the customer's fiat account







4 Steps

Open Recipe

- ## Off-Ramping USDC to a Customer's External Wallet







This recipe assumes you've on-ramped funds to the customer's USDC trading account and that you've added a USDC external wallet for the customer







4 Steps

Open Recipe

- ## Off-Ramping USD to a Customer's Verified Bank Account







This recipe assumes you've on-ramped funds to the customer's USD fiat account and that you've added a verified external bank account for the customer







4 Steps

Open Recipe

- ## Executing a P2P Transfer Between Customers







This recipe assumes you've funded a customer's fiat account and have created a second verified customer







4 Steps

Open Recipe

- ## Send a Payment to a Counterparty's External Wallet







This recipe assumes you've on-ramped funds to the customer's USDC trading account and that you've added a verified counterparty and a USDC external wallet for the counterparty







4 Steps

Open Recipe

- ## Swapping USDC on ETH to USDC on Polygon







This recipe assumes you've funded the customer's USDC on ETH account







4 Steps

Open Recipe


# Creating a Verified Individual Customer

Begin by adding a customer and verifying their identity

Create a new `individual` customer.

To create a `business` customer change the type to `business`.

Wait for the customer to settle in the `unverified` state before proceeding with an identity verification.

Create a new identity verification for the individual customer.

For individuals, set `type` to be `kyc` and `method` to be `id_and_selfie`.

For businesses, set `type` to be `kyc` and `method` to be `business_registration`.

Wait for the identity verification to enter the `pending` state before attempting to retrieve the `persona_inquiry_id`.

Retrieve the `persona_inquiry_id` from the `pending` identity verification and pass the `persona_inquiry_id` to the Persona SDK.

Launch the Persona SDK to prompt your customer to go through the Persona KYC flow.

Wait for your customer to complete the Persona KYC flow.

Retrieve the identity verification and check the `outcome`. If the identity verification has an `outcome` of `failed` the customer cannot proceed.

Retrieve a handle to the customer and wait for the customer to enter the `verified` state.

At this point, your customer is ready to transact on the platform.

```
xxxxxxxxxx
```

1

```
#
```

2

```
# Constants
```

3

```
#
```

4

```
​
```

5

```
CUSTOMER_TYPE_INDIVIDUAL = "individual"
```

6

```
CUSTOMER_TYPE_BUSINESS = "business"
```

7

```
​
```

8

```
IDENTITY_VERIFICATION_TYPE_KYC = "kyc"
```

9

```
IDENTITY_VERIFICATION_TYPE_BANK_ACCOUNT = "bank_account"
```

10

```
​
```

11

```
IDENTITY_VERIFICATION_METHOD_ID_AND_SELFIE = "id_and_selfie"
```

12

```
IDENTITY_VERIFICATION_METHOD_ACCOUNT_OWNERSHIP = "account_ownership"
```

13

```
​
```

14

```
IDENTITY_VERIFICATION_EXPECTED_BEHAVIOUR_PASSED_IMMEDIATELY = "passed_immediately"
```

15

```
​
```

16

```
STATE_CREATED = "created"
```

17

```
STATE_PENDING = "pending"
```

18

```
STATE_COMPLETED = "completed"
```

19

```
STATE_SETTLING = "settling"
```

20

```
STATE_WAITING = "waiting"
```

21

```
STATE_UNVERIFIED = "unverified"
```

22

```
STATE_VERIFIED = "verified"
```

23

```
​
```

24

```
OUTCOME_PASSED = "passed"
```

25

```
OUTCOME_FAILED = "failed"
```

26

```
​
```

27

```
ASSET_CODE_USD = "USD"
```

28

```
ASSET_CODE_USDC = "USDC"
```

29

```
​
```

30

```
ACCOUNT_TYPE_FIAT = "fiat"
```

31

```
ACCOUNT_TYPE_TRADING = "trading"
```

32

```
​
```

33

```
DEPOSIT_BANK_ACCOUNT_TYPE_MAIN = "main"
```

34

```
​
```

35

```
#
```

36

```
# Helpers
```

37

```
#
```

38

```
​
```

39

```
logger = logging.getLogger()
```

40

```
​
```

41

```
def create_customer(
```

42

```
    api_client: cybrid_api_bank.ApiClient, customer_type: str
```

43

```
) -> Customer:
```

44

```
    logger.info("Creating customer...")
```

45

```
​
```

46

```
    api_instance = CustomersBankApi(api_client)
```

47

```
    post_customer = PostCustomer(type=customer_type)
```

48

```
​
```

49

```
    try:
```

50

```
        # https://docs.cybrid.xyz/reference/createcustomer
```

51

```
        customer = api_instance.create_customer(post_customer)
```

52

```
        logger.info("Created customer: %s", customer.guid)
```

53

```
        return customer
```

54

```
    except cybrid_api_bank.OpenApiException as e:
```

55

```
        logger.error(f"An API error occurred when creating customer: {e}")
```

56

```
        raise e
```

57

```
​
```

58

```
​
```

59

```
def get_customer(api_client: cybrid_api_bank.ApiClient, guid: str) -> Customer:
```

60

```
    logger.info("Getting customer: %s", guid)
```

61

```
​
```

62

```
    api_instance = CustomersBankApi(api_client)
```

63

```
​
```

64

```
    try:
```

65

```
        # https://docs.cybrid.xyz/reference/getcustomer
```

66

```
        customer = api_instance.get_customer(guid)
```

67

```
        logger.info("Got customer: %s", customer.guid)
```

68

```
        return customer
```

69

```
    except cybrid_api_bank.OpenApiException as e:
```

70

```
        logger.error(f"An API error occurred when getting customer: {e}")
```

71

```
        raise e
```

72

```
​
```

73

```
​
```

74

```
def wait_for_customer(
```

75

```
    api_client: cybrid_api_bank.ApiClient,
```

76

```
    customer: Customer,
```

77

```
    expected_states: list[str],
```

78

```
) -> None:
```

79

```
    sleep_count = 0
```

80

```
    customer_state = customer.state
```

81

```
    final_states = expected_states
```

82

```
    while customer_state not in final_states and sleep_count < Config.TIMEOUT:
```

83

```
        time.sleep(1)
```

84

```
        sleep_count += 1
```

85

```
        customer = get_customer(api_client, customer.guid)
```

86

```
        customer_state = customer.state
```

87

```
    if customer_state not in final_states:
```

88

```
        raise BadResultError(f"Customer has invalid state: {customer_state}")
```

89

```
​
```

90

```
    logger.info(f"Customer successfully created with state {customer_state}")
```

91

```

```

92

```
def create_identity_verification(
```

93

```
    api_client: cybrid_api_bank.ApiClient,
```

94

```
    customer: Customer,
```

95

```
    verification_type: str,
```

96

```
    verification_method: str,
```

97

```
    expected_behaviours: list[str] | None = None,
```

98

```
) -> IdentityVerification:
```

99

```
    logger.info("Creating identity verification...")
```

100

```
​
```

101

```
    api_instance = IdentityVerificationsBankApi(api_client)
```

102

```
    post_identity_verification = PostIdentityVerification(
```

103

```
        type=verification_type,
```

104

```
        method=verification_method,
```

105

```
        customer_guid=customer.guid,
```

106

```
        expected_behaviours=expected_behaviours,
```

107

```
    )
```

108

```
​
```

109

```
    try:
```

110

```
        # https://docs.cybrid.xyz/reference/createidentityverification
```

111

```
        api_response = api_instance.create_identity_verification(
```

112

```
            post_identity_verification
```

113

```
        )
```

114

```
        logger.info("Created identity verification.")
```

115

```
        return api_response
```

116

```
    except cybrid_api_bank.OpenApiException as e:
```

117

```
        logger.error(f"An API error occurred when creating identity verification: {e}")
```

118

```
        raise e
```

119

```
​
```

120

```
​
```

121

```
def get_identity_verification(
```

122

```
    api_client: cybrid_api_bank.ApiClient, guid: str
```

123

```
) -> IdentityVerification:
```

124

```
    logger.info("Getting identity verification...")
```

125

```
​
```

126

```
    api_instance = IdentityVerificationsBankApi(api_client)
```

127

```
​
```

128

```
    try:
```

129

```
        # https://docs.cybrid.xyz/reference/getidentityverification
```

130

```
        identity_verification = api_instance.get_identity_verification(guid)
```

131

```
        logger.info("Got identity verification: %s", identity_verification.guid)
```

132

```
        return identity_verification
```

133

```
    except cybrid_api_bank.OpenApiException as e:
```

134

```
        logger.error(f"An API error occurred when getting identity verification: {e}")
```

135

```
        raise e
```

136

```
​
```

137

```
​
```

138

```
def wait_for_identity_verification(
```

139

```
    api_client: cybrid_api_bank.ApiClient,
```

140

```
    identity_verification: IdentityVerification,
```

141

```
    expected_states: list[str],
```

142

```
) -> None:
```

143

```
    sleep_count = 0
```

144

```
    identity_verification_state = identity_verification.state
```

145

```
    final_states = expected_states
```

146

```
    while (
```

147

```
        identity_verification_state not in final_states and sleep_count < Config.TIMEOUT
```

148

```
    ):
```

149

```
        time.sleep(1)
```

150

```
        sleep_count += 1
```

151

```
        identity_verification = get_identity_verification(
```

152

```
            api_client, identity_verification.guid
```

153

```
        )
```

154

```
        identity_verification_state = identity_verification.state
```

155

```
    if identity_verification_state not in final_states:
```

156

```
        raise BadResultError(
```

157

```
            f"Identity verification has invalid state: {identity_verification_state}"
```

158

```
        )
```

159

```
​
```

160

```
    logger.info(
```

161

```
        f"Identity verification successfully completed with state {identity_verification_state}"
```

162

```
    )
```

163

```
​
```

164

```
#
```

165

```
# Create customer
```

166

```
#
```

167

```
# This will create a customer of type "individual." To create a business
```

168

```
# customer, set `customer_type=CUSTOMER_TYPE_BUSINESS`.
```

169

```
#
```

170

```
# The customer will initially be in the `storing` state. Before proceeding,
```

171

```
# wait for the customer to be in the `unverified` state.
```

172

```
#
```

173

```
​
```

174

```
# Step 1: Create the customer
```

175

```
customer = create_customer(api_client, customer_type=CUSTOMER_TYPE_INDIVIDUAL)
```

176

```
​
```

177

```
# Step 2: Wait for the customer to settle in the `unverified` state.
```

178

```
wait_for_customer(api_client, customer, expected_states=[STATE_UNVERIFIED])
```

179

```
​
```

180

```
#
```

181

```
# Create identity verification
```

182

```
#
```

183

```
# This will initiate an identity verification that must be continued in an interactive fashion by
```

184

```
# the customer through Persona. This applies both for individuals and businesses.
```

185

```
#
```

186

```
# In order to verify a customer set the `type` to `kyc` and the `method` to either `id_and_selfie`
```

187

```
# for individuals (i.e., KYC) or `business_registration` for businesses (i.e., KYB).
```

188

```
#
```

189

```
# Identity verification is a four step process:
```

190

```
# 1. Create the identity verification (https://docs.cybrid.xyz/reference/createidentityverification).
```

191

```
#    This will immediately create an identity verification in the `storing` state.
```

192

```
# 2. Poll on the identity verification until it is in the `waiting` state. When in the `waiting` state
```

193

```
#    read the `persona_inquiry_id` value (https://docs.cybrid.xyz/reference/getidentityverification).
```

194

```
# 3. Launch the Persona SDK and pass it the `persona_inquiry_id` obtained in the previous step. For a
```

195

```
#    sample HTML application that launches the Persona SK see here:
```

196

```
#    https://docs.cybrid.xyz/docs/how-do-i-drive-kyc-manually.
```

197

```
# 4. Poll on the identity verification until it is in the `completed`. Check the `outcome` of the
```

198

```
#    identity verification, it will be either `passed` or `failed. If `failed`, the customer cannot
```

199

```
#    interact with the platform.
```

200

```
#
```

201

```
# Once these steps are completed and `state=completed` and `outcome=passed`, the customer state
```

202

```
# will be `verified`. You can get the state of the customer by retrieving the customer resource
```

203

```
# (https://docs.cybrid.xyz/reference/getcustomer).
```

204

```
#
```

205

```
# If the identity verification goes into the state `expired` then you can create a new identity
```

206

```
# verification and use the newly created `persona_inquiry_id` to verify the customer. If the
```

207

```
# identity verification is in the `waiting` state and the customer wants to resume their session,
```

208

```
# then you can re-use the `persona_inquiry_id` to verify the customer.
```

209

```
#
```

210

```
# If the identity verification goes into the state `pending` then it indicates the UBOs associated
```

211

```
# with the business must complete their KYC before the verification can proceed.
```

212

```
#
```

213

```
# To enhance the responsiveness of your application to state changes, you can also register for
```

214

```
# and receive webhooks for identity verification state changes See the article here:
```

215

```
# https://docs.cybrid.xyz/docs/webhooks.
```

216

```
#
```

217

```
​
```

218

```
# Step 1: Create the identity verification
```

219

```
identity_verification = create_identity_verification(
```

220

```
  api_client,
```

221

```
  customer,
```

222

```
  verification_type=IDENTITY_VERIFICATION_TYPE_KYC,
```

223

```
  verification_method=IDENTITY_VERIFICATION_METHOD_ID_AND_SELFIE,
```

224

```
)
```

225

```
​
```

226

```
# Step 2: Wait for the identity verification to go into the `waiting` state
```

227

```
wait_for_identity_verification(
```

228

```
    api_client, identity_verification, expected_states=[STATE_WAITING]
```

229

```
)
```

230

```
​
```

231

```
# Step 3: Retrieve the `persona_inquiry_id` and send the customer through the Persona flow
```

232

```
identity_verification = get_identity_verification(
```

233

```
  api_client, identity_verification.guid
```

234

```
)
```

235

```
logger.info(f"Persona inquiry id: {identity_verification.persona_inquiry_id}")
```

236

```
​
```

237

```
# Step 4: Wait for the identity verification to go into the `completed` state and chck
```

238

```
#         the outcome.
```

239

```
wait_for_identity_verification(
```

240

```
  api_client, identity_verification, expected_states=[STATE_COMPLETED]
```

241

```
)
```

242

```
​
```

243

```
identity_verification = get_identity_verification(
```

244

```
  api_client, identity_verification.guid
```

245

```
)
```

246

```
if identity_verification.outcome == OUTCOME_FAILED:
```

247

```
  raise BadResultError(
```

248

```
    f"Identity verification has an unexpected outcome: {identity_verification}."
```

249

```
  )
```

250

```
​
```

251

```
#
```

252

```
# Check the state of the customer
```

253

```
#
```

254

```
wait_for_customer(api_client, customer, expected_states=[STATE_VERIFIED])
```

#### Title